
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Running on Travis &#8212; Auditree Framework 2.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Running on Tekton" href="running-on-tekton.html" />
    <link rel="prev" title="Coding Standards" href="coding-standards.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="running-on-tekton.html" title="Running on Tekton"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="coding-standards.html" title="Coding Standards"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Auditree Framework 2.0.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Running on Travis</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="running-on-travis">
<span id="id1"></span><h1>Running on Travis<a class="headerlink" href="#running-on-travis" title="Permalink to this heading">¶</a></h1>
<p>Running the Auditree framework from a CI like Travis can be really useful for
executing your compliance checks periodically. Thus you can track the
current level of compliance for different standards and also notify
people whenever there is a failure, so it can be fixed in some way.</p>
<p>This can be done in many different ways, so you don’t have to follow
this guide if it does not fit your requirements. However, it always
useful to know what it is required so you can adapt this guide to your
needs.</p>
<p>Basically, this will what you will need:</p>
<ul class="simple">
<li><p>A <code class="docutils literal notranslate"><span class="pre">.travis.yml</span></code>: this will define the Travis run which will run
<code class="docutils literal notranslate"><span class="pre">travis/run.sh</span></code> script.</p></li>
<li><p>A git repository for storing generated evidence. You should create a
private project/org for this.</p></li>
<li><p>Credentials generator: for that, a python script can be used for
generating the credentials files from environment variables defined
in Travis.</p></li>
<li><p>Results storage: check results are stored to the evidence locker as
<code class="docutils literal notranslate"><span class="pre">check_results.json</span></code>.</p></li>
</ul>
<p>Bare in mind that a compliance check project is a bit tricky to
configure since you will be pushing new code there and also running
<strong>official</strong> compliance executions. You can resolve this issue by
having 2 Git repositories: one for check development with a
development Travis configuration and another one just for cloning it
and run <code class="docutils literal notranslate"><span class="pre">compliance</span></code> with official parameters.</p>
<p>However, this can be done in the same repository noting that there are
<cite>development</cite> runs (they will not notify nor push any evidence to the
evidence collector repository) and <cite>official</cite> runs (which will send
notifications and push evidences to Git).</p>
<section id="travis-artifacts">
<h2>Travis artifacts<a class="headerlink" href="#travis-artifacts" title="Permalink to this heading">¶</a></h2>
<p>This is a typical <cite>.travis.yml</cite> file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="nt">python</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3.7&quot;</span>
<span class="nt">install</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install -r requirements.txt</span>
<span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">make clean</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./travis/run.sh</span>
</pre></div>
</div>
<p>Basically, this will firstly install the dependencies through
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-r</span> <span class="pre">requirements.txt</span></code> and then generate the credentials file from
using Travis environment variables.</p>
<section id="credentials">
<h3>Credentials<a class="headerlink" href="#credentials" title="Permalink to this heading">¶</a></h3>
<p>The recommended way to use credentials in a CI job is to export them as environment variables.
Auditree will automatically parsed the environment variables available to the process and make them available to the fetchers if they follow a specific structure.</p>
<p>For more information on how to do this, have a look to the <a class="reference internal" href="design-principles.html#credentials"><span class="std std-ref">Credentials</span></a> section.</p>
</section>
<section id="travis-run-sh">
<h3><code class="docutils literal notranslate"><span class="pre">travis/run.sh</span></code><a class="headerlink" href="#travis-run-sh" title="Permalink to this heading">¶</a></h3>
<p>Travis will call this script in two different ways:</p>
<ul class="simple">
<li><p>As part of a change in the repo, so it would be considered a
development run.</p></li>
<li><p>A call through Travis API, made by a cron job (or a robot)
periodically. This will be considered the <cite>official</cite> run.</p></li>
</ul>
<p>This is an example of a <code class="docutils literal notranslate"><span class="pre">travis/run.sh</span></code> file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nv">NON_OFFICIAL</span><span class="o">=</span><span class="s2">&quot;--evidence no-push --notify stdout&quot;</span>
<span class="nv">OFFICIAL</span><span class="o">=</span><span class="s2">&quot;--evidence full-remote --notify slack&quot;</span>

<span class="c1"># is this an official run or not?</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$TRAVIS_BRANCH</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;master&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="nv">$TRAVIS_COMMIT_RANGE</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="c1"># this is official as it has been run by an external call</span>
<span class="w">  </span><span class="nv">OPTIONS</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$OFFICIAL</span><span class="s2">&quot;</span>
<span class="k">else</span>
<span class="w">  </span><span class="nv">OPTIONS</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$NON_OFFICIAL</span><span class="s2">&quot;</span>
<span class="k">fi</span>

<span class="c1"># run fetchers</span>
compliance<span class="w"> </span>--fetch<span class="w"> </span><span class="nv">$OPTIONS</span><span class="w"> </span>-C<span class="w"> </span>official.json

<span class="c1"># run checks</span>
compliance<span class="w"> </span>--check<span class="w"> </span><span class="nv">$ACCREDITATIONS</span><span class="w"> </span><span class="nv">$OPTIONS</span><span class="w"> </span>-C<span class="w"> </span>official.json
<span class="nv">retval</span><span class="o">=</span><span class="nv">$?</span>

<span class="nb">exit</span><span class="w"> </span><span class="nv">$retval</span>
</pre></div>
</div>
<p>Note that the arguments used in the <code class="docutils literal notranslate"><span class="pre">compliance</span></code> invocation depend
on whether this is an official run or not. This script assumes you
have stored the official configuration into <code class="docutils literal notranslate"><span class="pre">official.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;locker&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;repo_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://github.com/my-org/my-evidence-repo&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;notify&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;slack&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;demo.hipaa&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;#security-team&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;#hipaa-compliance&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;demo.soc2&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;#soc2-compliance&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;#operations&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Running on Travis</a><ul>
<li><a class="reference internal" href="#travis-artifacts">Travis artifacts</a><ul>
<li><a class="reference internal" href="#credentials">Credentials</a></li>
<li><a class="reference internal" href="#travis-run-sh"><code class="docutils literal notranslate"><span class="pre">travis/run.sh</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="coding-standards.html"
                          title="previous chapter">Coding Standards</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="running-on-tekton.html"
                          title="next chapter">Running on Tekton</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/running-on-travis.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="running-on-tekton.html" title="Running on Tekton"
             >next</a> |</li>
        <li class="right" >
          <a href="coding-standards.html" title="Coding Standards"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Auditree Framework 2.0.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Running on Travis</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, IBM.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.3.
    </div>
  </body>
</html>